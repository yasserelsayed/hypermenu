{"ast":null,"code":"import _slicedToArray from\"D:\\\\masterdegree\\\\projectHyperMenu\\\\react\\\\hyper_menu\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useReducer}from'react';import CustomLoader from'../custom_loader';import axios from'axios';import{useParams}from\"react-router-dom\";import{useCookies}from'react-cookie';import StudioSections from'./studiosections';import MenuPreview from'./menupreview';import Editor from'./editor';import{reducer,setReducerStateUpdated,getReducerStateUpdated}from'../reducers/studio_reducer';export default function MenuStudio(){var _useReducer=useReducer(reducer,[]),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var _useCookies=useCookies(['access_token']),_useCookies2=_slicedToArray(_useCookies,2),cookies=_useCookies2[0],setCookie=_useCookies2[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),laodingStatus=_useState2[0],setlaodingStatus=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),activeNodeIndex=_useState4[0],setActiveNodeIndex=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),activePageIndex=_useState6[0],setActivePageIndex=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),pagesList=_useState8[0],setPagesList=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),themesList=_useState10[0],setThemesList=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),selectedThemeClass=_useState12[0],setSelectedThemeClass=_useState12[1];var _useParams=useParams(),menuId=_useParams.menuId,menuName=_useParams.menuName,templateClass=_useParams.templateClass;var pageTitle=\"\";function removeMenuPage(){if(!pagesList)return;if(pagesList.length<=1){alert(\"This operation not allowed if total pages less that 2 pages\");return;}setlaodingStatus(true);var $id=pagesList[activePageIndex].id;activePageIndex=0;axios.delete('page/'+$id).then(function(res){getMenuPages();}).catch(function(error){setlaodingStatus(false);alert(error.message);});}function swapNodes($up,node){if(!state)return;var indx=state.indexOf(node);if($up&&indx==0||!$up&&indx==state.length-1)return;var current=state[indx];if($up){state[indx]=state[indx-1];state[indx-1]=current;setActiveNodeIndex(indx-1);}else{state[indx]=state[indx+1];state[indx+1]=current;setActiveNodeIndex(indx+1);}}function updateMenuPage(){var $name=pageTitle;if(!$name)$name=pagesList[activePageIndex].name;setlaodingStatus(true);axios.put('menu/'+menuId,{template_class:selectedThemeClass}).then(function(res){}).catch(function(error){alert(error.message);});axios.put('page/'+pagesList[activePageIndex].id,{name:$name,html_sections:JSON.stringify(state)}).then(function(res){getMenuPages();}).catch(function(error){setlaodingStatus(false);alert(error.message);});}function onNodeChange(){dispatch({type:\"init\",data:state});setReducerStateUpdated(true);}function getMenuPages(){axios.get('page?menu_id='+menuId).then(function(res){pageTitle=null;setlaodingStatus(false);setPagesList(res.data);setReducerStateUpdated(false);if(res.data[activePageIndex].html_sections)dispatch({type:\"init\",data:JSON.parse(res.data[activePageIndex].html_sections)});else dispatch({type:\"init\",data:[]});}).catch(function(error){setlaodingStatus(false);alert(error.message);});}function submitNewPage(){if(pageTitle.length==0)alert(\"Page title required\");else{setlaodingStatus(true);axios.post(\"page\",{name:pageTitle,menu_id:menuId}).then(function(res){pageTitle=null;updateMenuPage();}).catch(function(error){setlaodingStatus(false);alert(error.response.data.message);});}}function getThemes(){axios.get('themes').then(function(res){setThemesList(res.data);}).catch(function(error){alert(error.message);});}useEffect(function(){axios.defaults.headers.common['Authorization']=cookies.access_token;setSelectedThemeClass(templateClass);getMenuPages();getThemes();},[]);return/*#__PURE__*/React.createElement(\"div\",{class:\"studio\"},/*#__PURE__*/React.createElement(CustomLoader,{show:laodingStatus}),/*#__PURE__*/React.createElement(\"header\",null,/*#__PURE__*/React.createElement(\"nav\",{class:\"navbar  navbar-fixed-top navbar-default\"},/*#__PURE__*/React.createElement(\"div\",{class:\"container\"},/*#__PURE__*/React.createElement(\"div\",{class:\"navbar-header\"},/*#__PURE__*/React.createElement(\"a\",{class:\"navbar-brand\",href:\"./index.html\",title:\"\"},/*#__PURE__*/React.createElement(\"img\",{width:\"200px\",src:\"../../assets/images/icon.svg\",class:\"navbar-logo-img\",alt:\"\"}))),/*#__PURE__*/React.createElement(\"div\",{class:\"collapse navbar-collapse\",id:\"navbar-collapse-uarr\"},/*#__PURE__*/React.createElement(\"ul\",{class:\"nav navbar-nav navbar-right\"},/*#__PURE__*/React.createElement(\"li\",null,\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"#\"},\" \",/*#__PURE__*/React.createElement(\"span\",{class:\"text-primary\",onClick:function onClick(e){e.preventDefault();updateMenuPage();}},\"Save Page \",/*#__PURE__*/React.createElement(\"i\",{class:\"fa fa-floppy-o\",\"aria-hidden\":\"true\"})),\" \")),/*#__PURE__*/React.createElement(\"li\",null,\" \",/*#__PURE__*/React.createElement(\"a\",null,/*#__PURE__*/React.createElement(\"span\",null,\"|\"))),/*#__PURE__*/React.createElement(\"li\",null,\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"#\",onClick:function onClick(e){e.preventDefault();removeMenuPage();}},\" \",/*#__PURE__*/React.createElement(\"span\",{class:\"text-warning\"},\"Remove Page \",/*#__PURE__*/React.createElement(\"i\",{class:\"fa fa-trash\",\"aria-hidden\":\"true\"})))),/*#__PURE__*/React.createElement(\"li\",null,\" \",/*#__PURE__*/React.createElement(\"a\",null,/*#__PURE__*/React.createElement(\"span\",null,\"\\xA0 \\xA0\"))),/*#__PURE__*/React.createElement(\"li\",null,\" \",/*#__PURE__*/React.createElement(\"a\",null,/*#__PURE__*/React.createElement(\"span\",{class:\"text-muted\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:function onChange(e){pageTitle=e.currentTarget.value;},placeholder:pagesList[activePageIndex]&&pagesList[activePageIndex].name}),\" / \",menuName)))))))),/*#__PURE__*/React.createElement(\"div\",{class:\"row templates\"},themesList.map(function(item){return/*#__PURE__*/React.createElement(\"a\",{onClick:function onClick(e){e.preventDefault();setSelectedThemeClass(item.class);}},/*#__PURE__*/React.createElement(\"img\",{class:item.class==selectedThemeClass&&\"selectedItem\",width:\"80\",height:\"80\",src:item.thumbnail}),/*#__PURE__*/React.createElement(\"h6\",null,item.name));})),getReducerStateUpdated()&&/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"col-xs-12\"},/*#__PURE__*/React.createElement(\"center\",null,/*#__PURE__*/React.createElement(\"b\",null,/*#__PURE__*/React.createElement(\"small\",{class:\"text-danger\"},\"UNSAVED CHANGES PLEASE PRESS SAVE PAGE TO SAVE YOUR CHANGES\"))))),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"col-xs-12\"},/*#__PURE__*/React.createElement(StudioSections,{data:state,onDataChanged:onNodeChange,selectActiveNode:setActiveNodeIndex,updateNodes:function updateNodes(action){dispatch(action);}}),/*#__PURE__*/React.createElement(MenuPreview,{selectedNodeindex:activeNodeIndex,data:state,activeThemeClass:selectedThemeClass}),/*#__PURE__*/React.createElement(Editor,{swapNode:swapNodes,onDataChanged:onNodeChange,data:state[activeNodeIndex]}))),/*#__PURE__*/React.createElement(\"footer\",{class:\"studioFooter\"},/*#__PURE__*/React.createElement(\"div\",{class:\"tabs\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",onChange:function onChange(e){pageTitle=e.currentTarget.value;}}),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(e){e.preventDefault();submitNewPage();}},\" NEW \",/*#__PURE__*/React.createElement(\"i\",{class:\"fa fa-plus-circle\",\"aria-hidden\":\"true\"})),pagesList.map(function(item,index){if(index==activePageIndex)return/*#__PURE__*/React.createElement(\"a\",{href:\"#\",class:\"selectedPageTab\"},item.name);else return/*#__PURE__*/React.createElement(\"a\",{href:\"#\",onClick:function onClick(e){updateMenuPage();e.preventDefault();setActivePageIndex(index);activePageIndex=index;}},item.name);}))));}","map":{"version":3,"sources":["D:/masterdegree/projectHyperMenu/react/hyper_menu/src/page/menu_studio.js"],"names":["React","useState","useEffect","useReducer","CustomLoader","axios","useParams","useCookies","StudioSections","MenuPreview","Editor","reducer","setReducerStateUpdated","getReducerStateUpdated","MenuStudio","state","dispatch","cookies","setCookie","laodingStatus","setlaodingStatus","activeNodeIndex","setActiveNodeIndex","activePageIndex","setActivePageIndex","pagesList","setPagesList","themesList","setThemesList","selectedThemeClass","setSelectedThemeClass","menuId","menuName","templateClass","pageTitle","removeMenuPage","length","alert","$id","id","delete","then","res","getMenuPages","catch","error","message","swapNodes","$up","node","indx","indexOf","current","updateMenuPage","$name","name","put","template_class","html_sections","JSON","stringify","onNodeChange","type","data","get","parse","submitNewPage","post","menu_id","response","getThemes","defaults","headers","common","access_token","e","preventDefault","currentTarget","value","map","item","class","thumbnail","action","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect,useReducer } from 'react'\r\nimport CustomLoader from '../custom_loader'\r\nimport axios from 'axios';\r\nimport {useParams} from \"react-router-dom\";\r\nimport { useCookies } from 'react-cookie'\r\nimport StudioSections from './studiosections'\r\nimport MenuPreview from './menupreview'\r\nimport Editor from './editor'\r\nimport {reducer,setReducerStateUpdated,getReducerStateUpdated } from  '../reducers/studio_reducer'\r\n\r\n\r\nexport default function MenuStudio() {\r\n const [state, dispatch] = useReducer(reducer, []);\r\n const [cookies, setCookie] = useCookies(['access_token'])\r\n const [laodingStatus, setlaodingStatus] = useState(false)\r\n const [activeNodeIndex, setActiveNodeIndex] = useState(0)\r\n var [activePageIndex, setActivePageIndex] = useState(0)\r\n const [pagesList, setPagesList] = useState([])\r\n const [themesList, setThemesList] = useState([])\r\n const [selectedThemeClass, setSelectedThemeClass] = useState(\"\")\r\n const {menuId,menuName,templateClass} = useParams()\r\n var   pageTitle = \"\"\r\n\r\n\r\n\r\n function removeMenuPage(){\r\n  if(!pagesList) return;\r\n   if(pagesList.length <= 1){\r\n      alert(\"This operation not allowed if total pages less that 2 pages\")\r\n      return\r\n   }\r\n   setlaodingStatus(true)\r\n   var $id = pagesList[activePageIndex].id;\r\n   activePageIndex = 0;\r\n  axios.delete('page/'+$id)\r\n  .then(res => {\r\n    getMenuPages()\r\n  }).catch(error => {\r\n    setlaodingStatus(false)\r\n    alert(error.message)\r\n  })\r\n}\r\n\r\nfunction swapNodes($up,node){\r\n  if(!state) return\r\n  var indx = state.indexOf(node)\r\n  if(($up && indx==0) || (!$up && indx==state.length-1)) return\r\n  var current = state[indx] \r\n   if($up){\r\n    state[indx] = state[indx-1]  \r\n    state[indx-1] = current  \r\n    setActiveNodeIndex(indx-1)          \r\n    }else{\r\n      state[indx] = state[indx+1]  \r\n      state[indx+1] = current  \r\n      setActiveNodeIndex(indx+1)   \r\n    }\r\n}\r\n\r\nfunction updateMenuPage(){\r\n  var $name = pageTitle\r\n  if(!$name)\r\n  $name = pagesList[activePageIndex].name\r\n   setlaodingStatus(true)\r\n   axios.put('menu/'+menuId,{template_class:selectedThemeClass})\r\n   .then(res => {\r\n   }).catch(error => {\r\n     alert(error.message)\r\n   })\r\n  axios.put('page/'+pagesList[activePageIndex].id,{name:$name,html_sections:JSON.stringify(state)})\r\n  .then(res => {\r\n    getMenuPages()\r\n  }).catch(error => {\r\n    setlaodingStatus(false)\r\n    alert(error.message)\r\n  })\r\n}\r\n\r\nfunction onNodeChange(){\r\n  dispatch({type:\"init\",data:state})\r\n  setReducerStateUpdated(true)\r\n}\r\n\r\n\r\nfunction getMenuPages(){\r\n  axios.get('page?menu_id='+menuId)\r\n  .then(res => {\r\n    pageTitle = null\r\n    setlaodingStatus(false)\r\n    setPagesList(res.data)\r\n    setReducerStateUpdated(false)\r\n    if(res.data[activePageIndex].html_sections)\r\n         dispatch({type:\"init\",data:JSON.parse(res.data[activePageIndex].html_sections)})\r\n    else dispatch({type:\"init\",data:[]})\r\n  }).catch(error => {\r\n    setlaodingStatus(false)\r\n    alert(error.message)\r\n  })\r\n}\r\n\r\n function submitNewPage() {\r\n  if (pageTitle.length == 0) \r\n       alert(\"Page title required\")\r\n  else{\r\n    setlaodingStatus(true)\r\n    axios.post(`page`, {name:pageTitle,menu_id:menuId})\r\n      .then(res => {\r\n        pageTitle = null\r\n        updateMenuPage()\r\n      }).catch(error => {\r\n        setlaodingStatus(false)\r\n        alert(error.response.data.message);\r\n      })\r\n  } \r\n}\r\n\r\n\r\nfunction getThemes(){\r\n  axios.get('themes')\r\n  .then(res => {\r\n    setThemesList(res.data)\r\n  }).catch(error => {\r\n    alert(error.message)\r\n  })\r\n}\r\n\r\nuseEffect(() => {\r\n  axios.defaults.headers.common['Authorization'] = cookies.access_token;\r\n   setSelectedThemeClass(templateClass)\r\n  getMenuPages();\r\n  getThemes();\r\n}, [])\r\n  return (\r\n    <div class=\"studio\">\r\n          <CustomLoader show={laodingStatus} />\r\n            <header>\r\n        <nav class=\"navbar  navbar-fixed-top navbar-default\">\r\n          <div class=\"container\">\r\n            <div class=\"navbar-header\">\r\n              <a class=\"navbar-brand\" href=\"./index.html\" title=\"\">\r\n                <img width=\"200px\" src=\"../../assets/images/icon.svg\" class=\"navbar-logo-img\" alt=\"\" />\r\n              </a>\r\n            </div>\r\n            <div class=\"collapse navbar-collapse\" id=\"navbar-collapse-uarr\">\r\n        <ul class=\"nav navbar-nav navbar-right\">\r\n          <li> <a href=\"#\"> <span class=\"text-primary\" onClick={(e)=>{ e.preventDefault(); updateMenuPage();}}>Save Page <i class=\"fa fa-floppy-o\" aria-hidden=\"true\"></i></span> </a></li>\r\n          <li> <a ><span>|</span></a></li>\r\n          <li> <a href=\"#\" onClick={(e)=>{ e.preventDefault(); removeMenuPage();}}> <span class=\"text-warning\">Remove Page <i class=\"fa fa-trash\" aria-hidden=\"true\"></i></span></a></li>\r\n          <li> <a ><span>&nbsp; &nbsp;</span></a></li>\r\n          <li> <a ><span class=\"text-muted\"><input type=\"text\"   onChange={(e)=>{pageTitle = e.currentTarget.value}}  placeholder={pagesList[activePageIndex] && pagesList[activePageIndex].name} /> / {menuName}</span></a></li>\r\n        </ul>\r\n      </div>\r\n          </div>\r\n        </nav>\r\n      </header>\r\n  <div class=\"row templates\" >\r\n  {themesList.map((item)=>{\r\n                  return ( <a onClick={(e)=>{ e.preventDefault(); setSelectedThemeClass(item.class);}}><img class={item.class == selectedThemeClass && \"selectedItem\"} width=\"80\" height=\"80\" src={item.thumbnail}/><h6>{item.name}</h6></a>\r\n                  )\r\n                })}\r\n  </div>\r\n { getReducerStateUpdated() && (<div class=\"row\">\r\n    <div class=\"col-xs-12\">\r\n     <center><b><small class=\"text-danger\">UNSAVED CHANGES PLEASE PRESS SAVE PAGE TO SAVE YOUR CHANGES</small></b></center> \r\n      </div>\r\n   </div>)}\r\n  <div class=\"row\">\r\n    <div class=\"col-xs-12\">\r\n    <StudioSections data={state} onDataChanged={onNodeChange} selectActiveNode={setActiveNodeIndex}  updateNodes={(action)=>{dispatch(action)}} />\r\n    <MenuPreview selectedNodeindex = {activeNodeIndex} data={state} activeThemeClass={selectedThemeClass}  />\r\n    <Editor  swapNode={swapNodes} onDataChanged={onNodeChange} data={state[activeNodeIndex]}   />\r\n    </div>\r\n  </div>\r\n \r\n\r\n  <footer class=\"studioFooter\" >\r\n\r\n      <div class=\"tabs\">\r\n      <input type=\"text\"  onChange={(e) => { pageTitle = e.currentTarget.value}} ></input>\r\n      <button onClick={e => {\r\n                  e.preventDefault();\r\n                  submitNewPage()\r\n                  }}> NEW <i class=\"fa fa-plus-circle\" aria-hidden=\"true\"></i></button>\r\n                      {pagesList.map((item,index) => {\r\n                        if(index==activePageIndex)\r\n                             return  <a href=\"#\" class=\"selectedPageTab\">{item.name}</a>\r\n                       else  return (<a href=\"#\" onClick={e => {\r\n                        updateMenuPage();\r\n                        e.preventDefault();\r\n                        setActivePageIndex(index);\r\n                        activePageIndex = index;\r\n                        }}>{item.name}</a>)\r\n                      })}\r\n    </div>\r\n  </footer> \r\n    </div>\r\n  );\r\n}"]},"metadata":{},"sourceType":"module"}